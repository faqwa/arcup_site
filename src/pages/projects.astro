---
// ============================================================================
// FILE: src/pages/projects.astro
// ACTION: FULL REPLACEMENT - Complete rewrite with correct hierarchy
// CHANGES: 
// 1. Hero ‚Üí Getting Involved ‚Üí All Projects ‚Üí Build Your Own ‚Üí Legal
// 2. Dynamic project loading from markdown
// 3. SectionHeader component throughout
// 4. Cyan colored <strong> and <em> in hero
// ============================================================================
import BaseLayout from "../layouts/BaseLayout.astro";
import ArcCanvas from "../components/ArcCanvas.astro";
import PageNavigation from "../components/PageNavigation.astro";
import Card from "../components/Card.astro";
import LinkButton from "../components/LinkButton.astro";
import StatusBadge from "../components/StatusBadge.astro";
import SectionHeader from "../components/SectionHeader.astro";

import { getCollection } from 'astro:content';

import { withBase } from '../utils/paths';
import { buildSEO } from '../utils/seo';
import { EXTERNAL_LINKS } from '../config/constants';

// Get all projects dynamically
const allProjects = await getCollection('projects');

// Group projects by category (if they have one)
const projectsByCategory = allProjects.reduce((acc, project) => {
  const category = project.data.category || 'Other';
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(project);
  return acc;
}, {} as Record<string, typeof allProjects>);

// Get categories in a specific order (alphabetical, but 'Other' last)
const categories = Object.keys(projectsByCategory).sort((a, b) => {
  if (a === 'Other') return 1;
  if (b === 'Other') return -1;
  return a.localeCompare(b);
});

const seo = buildSEO({
  title: "Projects",
  description: "Active research projects in plasma technology for ecological repair. Open, collaborative, and building in public.",
  path: "/projects",
  siteUrl: Astro.site,
});
---

<BaseLayout
  title={seo.title}
  description={seo.description}
  bodyClass="page-projects"
  seo={seo}
  navActive="projects"
>
  <ArcCanvas slot="before-header" />

  <main id="main-content" class="page-shell" aria-labelledby="projects-title">
    
    <!-- HERO SECTION: Overview of ArcUp project portfolio and participation invite -->
    <header class="projects-hero" aria-labelledby="projects-title">
      <p class="eyebrow">Early-Stage Collaborative Research</p>
      <h1 id="projects-title">Projects</h1>
      <p class="lead">
        Each project applies RE:TECH principles ‚Äî <em>open, safe, iterative</em> ‚Äî and follows arc^'s licensing and governance. 
        <strong>These are real-world challenges that need collaborative solutions.</strong> Whether you're testing a hypothesis, 
        building hardware, or bringing community knowledge ‚Äî there's a way in.
      </p>
    </header>

    <!-- SECTION: Audience-specific guidance on how to engage -->
    <section class="getting-involved-section" aria-labelledby="getting-involved-title">
      <SectionHeader
        title="Getting Involved"
        subtitle="arc^ is in early stages, which means you can help shape the direction from the ground up."
      />

      <!-- GRID: Three involvement pathways -->
      <div class="involvement-grid">
        <!-- CARD: Student participation details -->
        <Card as="article" class="involvement-card">
          <div class="card-icon">üéì</div>
          <h3>For Students</h3>
          <p>Working on a final year project, honours thesis, or PhD? You can explore arc^ projects as part of your coursework.</p>
          <p class="card-note">We're here to support you ‚Äî whether that's access to equipment, guidance on safety protocols, or help framing research questions.</p>
        </Card>

        <!-- CARD: Researcher collaboration details -->
        <Card as="article" class="involvement-card">
          <div class="card-icon">üî¨</div>
          <h3>For Researchers</h3>
          <p>Have expertise in plasma physics, materials science, or ecological systems? Your knowledge can help validate approaches or identify new directions.</p>
          <p class="card-note">This isn't about gatekeeping ‚Äî it's about learning together and building on each other's insights.</p>
        </Card>

        <!-- CARD: General community invitation -->
        <Card as="article" class="involvement-card">
          <div class="card-icon">üõ†Ô∏è</div>
          <h3>For Everyone</h3>
          <p>You don't need a degree to contribute. Maybe you're a maker, a tinkerer, or someone with lived experience of the problems we're trying to solve.</p>
          <p class="card-note">If you're curious, willing to learn, and committed to safety ‚Äî there's a place for you.</p>
        </Card>
      </div>

      <!-- CTA: Link to external involvement form -->
      <div class="involvement-cta">
        <LinkButton href={EXTERNAL_LINKS.formURL} variant="primary" icon="external">
          Get Involved
        </LinkButton>
      </div>
    </section>

    <!-- SECTION: Dynamic project listing grouped by category -->
    <section class="all-projects-section" aria-labelledby="all-projects-title">
      <SectionHeader
        title="All Projects"
        subtitle="Each project follows RE:TECH principles ‚Äî open, safe, iterative ‚Äî and follows arc^'s licensing and governance."
      />

      <!-- LOOP: Iterate over project categories generated above -->
      {categories.map((category) => (
        <div class="project-category">
          {category !== 'Other' && (
            <h3 class="category-heading">{category}</h3>
          )}

          <!-- GRID: Project cards within {category} -->
          <div class="projects-grid">
            {projectsByCategory[category].map((project) => (
              <!-- CARD: Individual project summary with status badge -->
              <Card as="article" class="project-card">
                <div class="card-header">
                  <h4>
                    <a href={withBase(`/projects/${project.slug}`)}>{project.data.title}</a>
                  </h4>
                  <StatusBadge status={project.data.status} />
                </div>
                <p class="card-summary">{project.data.summary}</p>
                <p class="card-updated">Last updated: {project.data.lastUpdated}</p>
                <!-- CTA: Button linking to full project page -->
                <div class="card-actions">
                  <LinkButton href={withBase(`/projects/${project.slug}`)} variant="outline" icon="arrow-right">
                    Learn More
                  </LinkButton>
                </div>
              </Card>
            ))}
          </div>
        </div>
      ))}
    </section>

    <!-- SECTION: Encouragement to start new projects within framework -->
    <section class="build-your-own-section" aria-labelledby="build-your-own-title">
      <SectionHeader
        title="Build Your Own"
        subtitle="Don't see what you're looking for? You don't need our permission."
      />

      <!-- CALLOUT CARD: Highlights self-directed project pathway -->
      <Card class="build-your-own-content">
        <p>
          arc^ isn't about gatekeeping ‚Äî it's about <em>enabling</em>. If you understand
          <a href={withBase("/how")}>our philosophy</a> and commit to our <a href={withBase("/how/safety")}>safety protocols</a>
          and <a href={withBase("/how/licensing")}>open licensing</a>, you can start your own arc^ project.
        </p>
        <p>
          <strong>You have the power.</strong> Document your work. Share openly. Build for
          <em>life over profit</em>. That's all we ask.
        </p>
        <!-- CTA: Link to philosophy overview -->
        <div class="button-wrapper">
          <LinkButton href={withBase("/how")} variant="outline" icon="arrow-right">
            Learn the Philosophy
          </LinkButton>
        </div>
      </Card>
    </section>

    <!-- SECTION: Legal reminder about open licensing commitments -->
    <section class="legal-section">
      <h3>Open by Default</h3>
      <p>All arc^ projects follow our <a href={withBase("/how/licensing")}>non-extractive licensing model</a>. Research outputs, data, and designs stay in the commons.</p>
      <p>This ensures that <em>the many benefit</em>, not just a few.</p>
    </section>

  </main>

  <PageNavigation currentPage="projects" />
</BaseLayout>